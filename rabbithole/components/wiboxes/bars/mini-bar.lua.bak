local awful = require("awful")
local wibox = require("wibox")
local dpi = require("beautiful").xresources.apply_dpi
local gears = require("gears")
local beautiful = require("beautiful")
local darken = require("sub.nice.colors").darken

local minibar = {}

function minibar.new(options,
    settings,
    rabbithole__services__color,
    rabbithole__services__widetect
    )

    local minibar_size = dpi(34) or settings.minibar_size
    local colors = rabbithole__services__color
    local widetect = rabbithole__services__widetect
    local minibar = awful.popup({
        screen = options.screen,
        widget = options.widget or wibox.container.background,
        ontop = false,
        visible = true,
        maximum_height = dpi(minibar_size),
        minimum_height = dpi(minibar_size),
        placement = function(c)
            options.placement(c, {
                margins = dpi(2)
            })
        end,
        shape = function(cr, width, height)
            gears.shape.rounded_rect(cr, width, height, 10)
        end,
        --bg = colors.twocolortrue3d(beautiful.base_color, beautiful.secondary_color, minibar_size),
        border_width = dpi(0.5),
        border_color = darken(beautiful.base_color, 20),
    })
    minibar:struts{top = dpi(38)}

    return minibar
end

setmetatable(minibar, {
    __call = function(self, options)
        return self.new(options)
    end
})

return minibar
